<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>鹿港景點計時地圖</title>

<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}

/* 地圖 */
#map {
  width: 100%;
  height: 100%;
}

/* 半透明遮罩（關鍵） */
#overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.25);
  z-index: 9998;
}

/* 是否啟用定位 */
#controlBox {
  position: fixed;
  bottom: 25%;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 18px 22px;
  border-radius: 14px;
  text-align: center;
  z-index: 9999;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  pointer-events: auto;
}

#controlBox button {
  font-size: 16px;
  padding: 10px 16px;
  margin: 6px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}

.start-btn {
  background: #4CAF50;
  color: white;
}

.cancel-btn {
  background: #ddd;
}

/* 計時器 */
#timerBox {
  position: fixed;
  top: 16px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255,255,255,0.95);
  padding: 10px 20px;
  border-radius: 12px;
  font-size: 18px;
  font-weight: bold;
  z-index: 9999;
  display: none;
}
</style>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9yd5GeV-J0SHVtpkeHvtFfSryaavAKIE"></script>
</head>

<body>

<!-- 地圖一定要先 -->
<div id="map"></div>

<!-- 遮罩 -->
<div id="overlay"></div>

<!-- 是否啟用定位 -->
<div id="controlBox">
  <div style="margin-bottom:10px;font-size:16px;">
    是否要啟用定位並開始計時？
  </div>
  <button class="start-btn" onclick="startGeolocation()">啟用定位</button>
  <button class="cancel-btn" onclick="skipGeolocation()">不啟用</button>
</div>

<!-- 計時器 -->
<div id="timerBox">已花費時間：<span id="timer">00:00:00</span></div>

<script>
const locations = [
  { name: "玻璃館", lat: 24.068667, lng: 120.395437 },
  { name: "鹿港老街", lat: 24.056348, lng: 120.432589 },
  { name: "鹿港龍山寺", lat: 24.0504, lng: 120.4349 },
  { name: "鹿港天后宮", lat: 24.059338, lng: 120.431380 },
  { name: "玻璃媽祖廟", lat: 24.069118, lng: 120.394715 },
  { name: "桂花巷藝術村", lat: 24.055848, lng: 120.431928 },
  { name: "臺灣玻璃館", lat: 24.068970, lng: 120.394912 },
  { name: "鹿港民俗文物館", lat: 24.054200, lng: 120.436306 },
  { name: "九曲巷", lat: 24.0535, lng: 120.4350 },
  { name: "十宜樓", lat: 24.0535, lng: 120.4353 },
  { name: "鹿港意樓", lat: 24.0529, lng: 120.4353 },
  { name: "摸乳巷", lat: 24.051817, lng: 120.432231 }
];

let map, userMarker, startTime, timerInterval;
let remainingLocations = new Set(locations.map(l => l.name));

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 24.056348, lng: 120.432589 },
    zoom: 15
  });

  locations.forEach(loc => {
    loc.marker = new google.maps.Marker({
      position: { lat: loc.lat, lng: loc.lng },
      map,
      title: loc.name
    });
  });
}

function startGeolocation() {
  document.getElementById("controlBox").style.display = "none";
  document.getElementById("overlay").style.display = "none";
  document.getElementById("timerBox").style.display = "block";

  navigator.geolocation.watchPosition(onLocationUpdate);
}

function skipGeolocation() {
  document.getElementById("controlBox").style.display = "none";
  document.getElementById("overlay").style.display = "none";
  alert("已進入僅瀏覽模式");
}

function onLocationUpdate(pos) {
  const p = { lat: pos.coords.latitude, lng: pos.coords.longitude };
  if (!userMarker) {
    userMarker = new google.maps.Marker({
      position: p,
      map,
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 8,
        fillColor: "red",
        fillOpacity: 1,
        strokeWeight: 2
      }
    });
    map.setCenter(p);
    map.setZoom(18);
    startTimer();
  } else {
    userMarker.setPosition(p);
  }
}

function startTimer() {
  startTime = Date.now();
  timerInterval = setInterval(() => {
    const t = Date.now() - startTime;
    document.getElementById("timer").textContent = formatTime(t);
  }, 1000);
}

function formatTime(ms) {
  let s = Math.floor(ms / 1000);
  const h = String(Math.floor(s / 3600)).padStart(2, "0");
  s %= 3600;
  const m = String(Math.floor(s / 60)).padStart(2, "0");
  const sec = String(s % 60).padStart(2, "0");
  return `${h}:${m}:${sec}`;
}

window.onload = initMap;
</script>

</body>
</html>


